<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <script src="lib.js"></script>
  <script>
    let id = 0;
    let selection;
    function populate(state, data) {
      for (compat_tool of data) {
         const option = document.createElement('option');
         option.value = compat_tool.id;
         option.textContent = compat_tool.name;
         selection.appendChild(option)
      }
      load_transition();
    }

    function populate_compat() {
      selection = document.getElementsByName("compat_tool")[0];
      getJSON("http://127.0.0.1:8000/api/compat_tools", populate)

    }

    function add_subgame() {
      let subgame_area = document.getElementById("subgames");
      let subgame_elements = document.getElementsByName('subgame_meta');
      let subgame_dummy = document.getElementById("subgame_dummy").cloneNode(true);
      subgame_dummy.children[0].innerHTML="<b>Sub-Game " + (subgame_elements.length-1) + "</b>";
      subgame_dummy.style = "";
      subgame_dummy.name = "subgame_meta";
      subgame_dummy.id = "";
      subgame_area.appendChild(subgame_dummy);
    }

    function remove_subgame(button) {
      button.parentElement.remove()
    }

    function synthesize_json() {
      // first create game (name, subgames) 
      // put subgames into list (name, playtime, last_launch)
      // call back to /api/games?add
      
      // put down launch config (arguments[], working_directory, game_prefix, executable, environment, archive_file) /api/game_conf?id=
      // assign compat_tool /api/assign_compat?tool=&game=

      // upload images /api/media?game=&location=
    }

    function onload() {
      id = parseIdFromUrl();
      if (id){
        document.body.style.backgroundImage="url(/api/media?game="+id+"&location=background)";
      }
      populate_compat()
    }
  </script>
</head>
<body onload="onload()">
 <div id="fade-overlay"></div> 
    <div class="blur_layer">
      <div class="flex_center">
        <div class = "center_popup">
          <h2 style="margin-bottom: 2rem;">Add Game:</h2>
          <span>Game Name:</span>
          <input type="text" name="name" id="game_name" placeholder="Some Game">
          <span>Game Card (600x900) (2.5 MB max):</span>
          <input type="file" name="gamecard" value="">
          <span>Game Background (2.5 MB max):</span>
          <input type="file" name="background" value="" style="margin-bottom: 3em">
          <span>Sub-Games:</span>
          <div class="subgames scrollable" id="subgames" style="text-align:left; padding: 1%">
            <div id="subgame_dummy" class="subgame" name="subgame_meta" style="display:none">
              <span><b>Sub-Game 0</b></span><br><br>
              <span>Sub-Game Name:</span>
              <input type="text" name="subname0_name" id="subgame0_name" placeholder="[leave empty for same]">
              <span>Sub-Game Card (leave empty to use same):</span>
              <input type="file" name="sgcard" value="">
              <span>Sub-Game Playtime (hours):</span>
              <input type="number" name="subgame0_playtime" id="subgame0_playtime" value=0.0 step=0.1>
              <span>Compatability Tool:</span>
              <select name="compat_tool"></select>
              <span>Working Directory:</span>
              <input type="text" name="workdir" value="">
              <span>Wine Prefix:</span>
              <input type="text" name="winprefix" value="">
              <span>Game Executeable:</span>
              <input type="text" name="gamex" value="">
              <span>Launch Arguments:</span>
              <input type="text" name="launch_args" value="">
              <span>Environment:</span><br>
              <input type="text" name="env" value="" placeholder="SOME_VARIABLE,some value;SOME_OTHER_VAR,some value">
              <div class="button red" onclick="remove_subgame(this)">
                - Remove
              </div>
            </div>
            <div name="subgame_meta" class="subgame">
              <span><b>Sub-Game 0</b></span><br><br>
              <span>Sub-Game Name:</span>
              <input type="text" name="subname0_name" id="subgame0_name" placeholder="[leave empty for same]">
              <span>Sub-Game Card (leave empty to use same):</span>
              <input type="file" name="sgcard" value="">
              <span>Sub-Game Playtime (hours):</span>
              <input type="number" name="subgame0_playtime" id="subgame0_playtime" value=0.0 step=0.1>
              <span>Compatability Tool:</span>
              <select name="compat_tool"></select>
              <span>Working Directory:</span>
              <input type="text" name="workdir" value="">
              <span>Wine Prefix:</span>
              <input type="text" name="winprefix" value="">
              <span>Game Executeable:</span>
              <input type="text" name="gamex" value="">
              <span>Launch Arguments:</span>
              <input type="text" name="launch_args" value="">
              <span>Environment:</span><br>
              <input type="text" name="env" value="" placeholder="SOME_VARIABLE,some value;SOME_OTHER_VAR,some value">
            </div>
          </div>
          <div class="button" onclick="add_subgame()">
          + Add Sub-Game
          </div>
          <div class="button green">
            Finish
          </div>
        </div>
      </div>
    </div>
</body>
</html>
